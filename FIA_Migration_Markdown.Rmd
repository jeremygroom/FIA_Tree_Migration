---
title: "West coast U.S. tree species evidence shifts in density but not range "  
output:
  word_document:
    reference_docx: template_use2.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
knitr::knit_hooks$set(inline = function(x) {   if (!is.numeric(x)) {x} else { prettyNum(round(x, 2), big.mark = ",") } })  # This places commas to delineate thousands places
```


```{r libraries.to.load}
library(tidyverse)
library(grid)
library(gridExtra)
library(ggplotify) # enables as.grob() function
library(png)
library(knitr)
library(readxl)
library(writexl)
library(xfun)
library(ggspatial)
library(sp)
library(cowplot)
library(rnaturalearth)
library(parallel)      # Parallel computation, for running analysis of metric change.
library(spdep)  # Spatial dependence
library(spatialreg)
```


```{r constants}
data.file.loc <- "Data/"
ms.file.loc <- "Manuscript/" 
occ.temp.res.loc <- "Results/Occ_Results/Temp1/"
occ.precip.res.loc <- "Results/Occ_Results/annpre1/"
num.temp.res.loc <- "Results/TreeNum_Results/Temp1/"
num.precip.res.loc <- "Results/TreeNum_Results/annpre1/"
metric.chng.res.loc <- "Results/MetricChange_Results/"
  
 # For the metric change analysis, loading correct files for precipitation and temperature
prepost2_temp <- "pre.temp"
deltaTP2_temp <- "delta.T"

prepost2_precip <- "pre.precip"
deltaTP2_precip <- "delta.P"




```


```{r load_data}
source("ShinyCode/global.R")
source("ShinyCode/functions.r")

total.plots <- read_csv(paste0(data.file.loc, "plot052120.csv"))
oo.sum <- apply(occ_orig[, 3:ncol(occ_orig)], 1, sum) # Sum of all used tree spp occupancy codes across first-visit plots
or.sum <- apply(occ_revis[, 3:ncol(occ_revis)], 1, sum) # Sum of all used tree spp occupancy codes across second-visit plots
occ_total <- oo.sum + or.sum        # Combining first & second visit occupancy codes to determine how many plots were occupied by >= 1 of our species.

    # For Table 1, calculating the number of sites that stayed occupied or became extirpated or colonized.
occ_minus <- occ_orig[3:52] - occ_revis[3:52]     # -1 = colonized, +1 = extirpated
n.colonized <- apply(occ_minus, 2, function(x) length(x[x == -1]))
n.extir <- apply(occ_minus, 2, function(x) length(x[x == 1]))
occ_plus <- occ_orig[3:52] + occ_revis[3:52]      # 2 = occupied both visits
n.nochange <- apply(occ_plus, 2, function(x) length(x[x == 2]))
occ.chng <- tibble(SPCD = as.numeric(substr(names(occ_orig[3:52]), 2, nchar(occ_orig[3:52]))), n.nochange, n.extir, n.colonized)


tot.num.gt.lt <- read_csv(paste0(data.file.loc, "Total.Num.GT.LT.csv"))          # Used for greater than/less than numbers of trees in plot for Table 1.
not.used.spp <- read_csv(paste0(occ.temp.res.loc, "NotUsedSpp_Temp_1.csv"))   %>%                   # For Table 1, species not included in the analysis
  filter(SciName != "Prunus spp.", SciName != "Salix spp.", SciName != "Tree unknown")
  # Temperature range-shift (occupancy) results
occ.results.t <- dat1$occ.t1.e %>% 
  mutate(cooler = ifelse(LCI < 0 & UCI < 0, 1, 0),
         warmer = ifelse(LCI > 0 & UCI > 0, 1, 0))
 # Precipitation range-shift results
occ.results.p <- dat1$occ.p1.e %>% 
  mutate(drier = ifelse(LCI < 0 & UCI < 0, 1, 0),
         wetter = ifelse(LCI > 0 & UCI > 0, 1, 0))
 # Summer VPD range-shift results
occ.results.s

  # Temperature density (number) results
num.results.t <- dat1$num.t1.e %>% 
  mutate(cooler = ifelse(LCI < 0 & UCI < 0, 1, 0),
         warmer = ifelse(LCI > 0 & UCI > 0, 1, 0))

  # Precipitation density results
num.results.p <- dat1$num.p1.e %>% 
  mutate(drier = ifelse(LCI < 0 & UCI < 0, 1, 0),
         wetter = ifelse(LCI > 0 & UCI > 0, 1, 0))

occ.gls.t <- round(gls1$gls.occ.t1, 3)
occ.gls.p <- round(gls1$gls.occ.p1, 3)


num.gls.t <- gls1$gls.num.t1
num.gls.p <- gls1$gls.num.p1

num.BSresults <- dat1$num.t1.bs %>% 
  mutate(cooler = ifelse(LCI < 0 & UCI < 0, 1, 0),
         warmer = ifelse(LCI > 0 & UCI > 0, 1, 0)) 

#n.num.PlotBSvsEst <- read_csv(paste0(data.file.loc, "/TreeNum_Results/n.num.PlotBSvsEst.csv"))

ml.results <- read_csv(paste0(data.file.loc, "MonleonLintz.csv"))

```


```{r prepare_data_outputs}
total.plot.num <- length(unique(paste0(total.plots$PLOT_FIADB, total.plots$STATECD)))  # This includes intensification plots, which were not used in the 2015 paper
total.plot.for.num <- length(unique(paste0(total.plots$PLOT_FIADB[total.plots$propfor > 0], total.plots$STATECD[total.plots$propfor > 0])))  # Proportion forested > 0

total.plot.miss.num <- length(unique(paste0(total.plots$PLOT_FIADB[total.plots$propmiss == 1], total.plots$STATECD[total.plots$propmiss == 1])))  # Proportion missed = 1.  Right? about 1k higher than before
total.plots.occ <- length(occ_total[occ_total != 0])


# Table 1
  # This code combines output from the occupancy and tree number analyses
t1 <- dat1$occ.p1.e %>% left_join(tot.num.gt.lt, by = c("spp.codes" = "SPCD")) %>%
  left_join(occ.chng, by = c("spp.codes" = "SPCD")) %>%
  dplyr::select(SciName, n.nochange, n.extir, n.colonized, n_1, n_3)
#dplyr::select(SciName, Spp.symbol, n.orig, n.revis, n_1, n_3)
names(t1) <- c("Species", "Remained Occupied", "Extirpated", "Colonized", "Lost", "Gained")
t1$Species <- paste0(rep("*", nrow(t1)), t1$Species, rep("*", nrow(t1)))
write_xlsx(t1, paste0(ms.file.loc, "Table1.xlsx"))

# Related to Table 1

nOccSpp <- nrow(t1)#numbers_to_words(nrow(t1), cap = F, hyphen = F)
minOccPlots <- min(apply(data.frame(x1 = t1[, 2], x2 = t1[, 2] - t1[, 3] + t1[, 4]), 1, min)  )                  # Minimum number of plots occupied at either time period by any species
nNtreeSpp <- numbers_to_words(nrow(t1[t1$Lost > 50 & t1$Gained > 50, ]), cap = T)  # Number of tree-number analysis species reported on 
minNtreePlots <- min(t1[t1$Lost > 50 & t1$Gained > 50, c(5, 6)])  # Minimum number of gained/lost plots used for tree-number analysis of any species 

not.used.spp.vec <- not.used.spp$SciName
not.used.spp.vec1 <- paste0(not.used.spp.vec[1:(length(not.used.spp.vec) - 1)], collapse = ", ")
not.used.spp.vec2 <- not.used.spp.vec[length(not.used.spp.vec) ]

# Results Paragraph 1

n.occ.cooler.all <-  numbers_to_words(length(occ.results.t$temSE[occ.results.t$temactmean < 0]), cap = T, hyphen = TRUE)
n.occ.cooler <- sum(occ.results.t$cooler)
n.occ.warmer <- sum(occ.results.t$warmer)
occ.warmer.spp <- paste0(occ.results.t$SciName[occ.results.t$warmer == 1], collapse = ", ")
occ.cooler.spp <- occ.results.t$SciName[occ.results.t$cooler == 1]
p.est.occ.t <- round((1 - pbinom((n.occ.cooler + n.occ.warmer), nrow(t1), 0.025)), digits = 3) 

      # New: looking at expected number of false positives if no signal



# Results Paragraph 2

n.occ.drier.all <-  numbers_to_words(length(occ.results.p$temSE[occ.results.t$temactmean < 0]), cap = F, hyphen = FALSE)
n.occ.wetter <- sum(occ.results.p$wetter)
n.occ.drier <- sum(occ.results.p$drier)
occ.wetter.spp <- paste0(occ.results.p$SciName[occ.results.p$wetter == 1], collapse = ", ")
occ.drier.spp <- occ.results.p$SciName[occ.results.p$drier == 1]
p.est.occ.p <- round((1 - pbinom((n.occ.wetter + n.occ.drier), nrow(t1), 0.025)), digits = 3) 

# Results Paragraph 4

n.num.cooler <- sum(num.results.t$cooler)
n.num.warmer <- sum(num.results.t$warmer)
num.warmer.spp <- num.results.t$SciName[num.results.t$warmer == 1]
num.cooler.spp <- paste0(num.results.t$SciName[num.results.t$cooler == 1], collapse = ", ")
p.est.num <- round((1 - pbinom((n.num.cooler + n.num.warmer), nrow(num.results.p), 0.025)), digits = 3) 
num.gls.t <- round(num.gls.t, 3) 

# Results Paragraph 5

n.num.drier.all <- numbers_to_words(length(num.results.p$temSE[num.results.t$temactmean < 0]), cap = F, hyphen = FALSE)
n.num.wetter <-  sum(num.results.p$wetter)
n.num.drier <- sum(num.results.p$drier)
num.wetter.spp <- num.results.p$SciName[num.results.p$wetter == 1]
num.drier.spp <- paste0(num.results.p$SciName[num.results.p$drier == 1], collapse = ", ")
p.est.num <- round((1 - pbinom((n.num.wetter + n.num.drier), nrow(num.results.p), 0.025)), digits = 3) 
num.gls.p <- round(num.gls.p, 2) 

# Results Paragraph 6
n.num.sig <- length(num.results.t$SciName[num.results.t[, 11:12] == 1])

# Original (now removed) Table 2 of comparisons with Monleon & Lintz 2015.  The code is still used for certain comparisons
occ1 <- occ.results.t %>% select(SciName, temactmean, cooler, warmer) %>% 
  mutate(Range.occ = ifelse(temactmean < 0, "Cool", "Warm"),
         sig.occ = ifelse(cooler == 1 | warmer == 1, 1, 0)) %>% select(-temactmean, -cooler, -warmer) %>%
#occ2 <- occ.BSresults %>% select(SciName, mean, cooler, warmer) %>%   
#  mutate(RangeBS = ifelse(mean < 0, "Cool", "Warm"),
#         sig.occBS = ifelse(cooler == 1 | warmer ==1, 1, 0)) %>% select(-mean, -cooler, -warmer)
#occ3 <- left_join(occ1, occ2, by = "SciName") %>%
  mutate(Range = ifelse(sig.occ == 1 , paste0("**", Range.occ, "**"), Range.occ)) %>%
#                        ifelse(sig.occ == 0 & sig.occBS ==1, paste0("***", Range.occ, "***"), Range.occ) )) %>%
  select(SciName, Range)

num1 <- num.results.t %>% select(SciName, temactmean, cooler, warmer) %>% 
  mutate(Number.num = ifelse(temactmean < 0, "Cool", "Warm"),
         sig.num = ifelse(cooler == 1 | warmer == 1, 1, 0)) %>% select(-temactmean, -cooler, -warmer) %>%
#num2 <- num.BSresults %>% select(SciName, mean, cooler, warmer) %>%   
#  mutate(NumberBS = ifelse(mean < 0, "Cool", "Warm"),
#         sig.numBS = ifelse(cooler == 1 | warmer ==1, 1, 0)) %>% select(-mean, -cooler, -warmer)
#num3 <- left_join(num1, num2, by = "SciName") %>%
  mutate(Density = ifelse(sig.num == 1, paste0("**", Number.num, "**"), Number.num)) %>%
#                        ifelse(sig.num == 0 & sig.numBS ==1, paste0("***", Number.num, "***"), Number.num) )) %>%
  select(SciName, Density)

tree.type <- ml.results %>% select(Species, Type)
ml1 <- ml.results %>% select(Species, "Life Stage", sig) %>%
  drop_na() %>%
  mutate(`Life Stage` = ifelse(sig == 1, paste0("**", `Life Stage`, "**"), `Life Stage`)) %>%
  select(-sig)
t2 <- full_join(occ1, num1, by = "SciName")
t2 <- full_join(t2, ml1, by = c("SciName" = "Species"))
t2 <- full_join(t2, tree.type, by = c("SciName" = "Species"))
t2[is.na(t2)] <- ""
t2$SciName <- paste0("*", t2$SciName, "*")
names(t2)[1] <- "Scientific Name"

range.shift.angio <- length(t2$Type[t2$Range != "" & t2$Type == "Angio"])
range.shift.gymno <- length(t2$Type[t2$Range != "" & t2$Type == "Gymno"])
dens.shift.angio <- length(t2$Type[t2$Density != "" & t2$Type == "Angio"])
dens.shift.gymno <- length(t2$Type[t2$Density != "" & t2$Type == "Gymno"])
#write_xlsx(t2, paste0(ms.file.loc, "Table2.xlsx"))


## Table 2 (previously Table 3) prep

if (all(file.exists(paste0(metric.chng.res.loc, "SpatialLM_", prepost2_temp, "_", deltaTP2_temp, ".rds")),
        file.exists(paste0(metric.chng.res.loc, "SpatialLM_", prepost2_precip, "_", deltaTP2_precip, ".rds"))) == FALSE) {
  source("ShinyCode/MetricChange_Regressions.R")  # If this runs (i.e., files are not found) it'll do so for ~ 4 hours.
  
} else if (file.exists(paste0(metric.chng.res.loc, "Table3.csv")) == FALSE) {
  
  # If Table 3 isn't found, first, read in the output from the MetricChange_Regressions.R function.  
  chng.temp <- read_rds(paste0(metric.chng.res.loc, "SpatialLM_", prepost2_temp, "_", deltaTP2_temp, ".rds"))
  chng.precip <- read_rds(paste0(metric.chng.res.loc, "SpatialLM_", prepost2_precip, "_", deltaTP2_precip, ".rds"))
  
  # Next, summarizing those findings for table 3.
  chng.temp$slope.pos <- ifelse(is.na(chng.temp$slp.p) == FALSE & (chng.temp$pred2 > chng.temp$pred1) == TRUE, 1,
                                ifelse(is.na(chng.temp$slp.p) == FALSE & (chng.temp$pred2 < chng.temp$pred1) == TRUE, -1, 0))
  
  chng.temp$intercept.pos <- ifelse((chng.temp$int.alone.est > 0) == TRUE , 1, 0)
  
  chng.precip$slope.pos <- ifelse(is.na(chng.precip$slp.p) == FALSE & (chng.precip$pred2 > chng.precip$pred1) == TRUE, 1,
                                  ifelse(is.na(chng.precip$slp.p) == FALSE & (chng.precip$pred2 < chng.precip$pred1) == TRUE, -1, 0))
  
  chng.precip$intercept.pos <- ifelse((chng.precip$int.alone.est > 0) == TRUE , 1, 0)
  
  t3.delta.T <- chng.temp %>% dplyr::select(spp, int.alone.p, intercept.pos, slope.true, slp.p, slp.coef) %>% data_frame() %>%
    group_by(factor(intercept.pos, levels = c(1, 0))) %>%
    summarize(sig.int = length(int.alone.p[int.alone.p < 0.025]),
              sig.slp.pos = length(slope.true[slope.true == 1 & slp.p < 0.025 & slp.coef > 0]), 
              sig.slp.neg = length(slope.true[slope.true == 1 & slp.p < 0.025 & slp.coef < 0]))
  
  t3.delta.P <- chng.precip %>% dplyr::select(spp, int.alone.p, intercept.pos, slope.true, slp.p, slp.coef) %>% data_frame() %>%
    group_by(factor(intercept.pos, levels = c(1, 0))) %>%
    summarize(sig.int = length(int.alone.p[int.alone.p < 0.025]),
              sig.slp.pos = length(slope.true[slope.true == 1 & slp.p < 0.025 & slp.coef > 0]), 
              sig.slp.neg = length(slope.true[slope.true == 1 & slp.p < 0.025 & slp.coef < 0]))
  
  
  # Creating the table
  t3 <- bind_rows(t3.delta.T, t3.delta.P)
  names(t3) <- c("Metric", "Intercept", "Slope +", "Slope -")
  t3[, 1] <- c(paste0(c("+", "-", "+", "-"), "$\\Delta$", c("T", "T", "P", "P")))
  
  write_csv(t3, paste0(metric.chng.res.loc, "Table3.csv") ) 
  
} else {
  
  t3 <- read_csv(paste0(metric.chng.res.loc, "Table3.csv"))
  t.int.pos <- t3$Intercept[1]
  p.int.pos <- t3$Intercept[3]
  p.int.neg <- t3$Intercept[4]
  
}

#t3.caption = paste0("Table 2. Summary of spatial simultaneous autoregressive error model estimation of changes in plot temperature and precipitation across species' ranges #between the first and second visits (see text). The column Metric is the mean positive or negative (+, -) change in either temperature or precipitation ($\Delta$T, #$\Delta$P).  Intercept is the number of species with significant (p < 0.025) intercept estimates for intercept-only models.  The columns Slope+ and Slope- report the number #of species which were better modeled with positive and negative slope terms, respectively, with the initial visit plot temperature or precipitation value serving as the #model's independent variable.   
#")

```
 
 
 
```{r fig.map.generate}

# The forested points distribution map was created as a QGIS project.  I attempted to create a version using R
#  but wasn't pleased with it.  The R version will truly display all current points, if that is desired.  The code
#  looks first for the PNG from the QGIS project ("PointDist.png").  If that is missing it next looks for the R PNG file
#  ("ForestedPts_Fig.png").  If that is missing too, it recreates the figure, saves it, and calls for it.

if (file.exists(paste0(ms.file.loc, "PointDist.png"))) {  # First looking for QGIS map
forest.pts <-  include_graphics(paste0(ms.file.loc, "PointDist.png"))
  
} else if (file.exists(paste0(ms.file.loc, "ForestedPts_Fig.png"))) {  # Now looking for the R-created map
forest.pts <-   include_graphics(paste0(ms.file.loc, "ForestedPts_Fig.png"))
  
} else {   # Now it makes the R map.
  # Finding all forested plots and defining and saving lat/lon.
  total.plots2 <- total.plots %>% mutate(State_Plot = as.numeric(paste0(PLOT_FIADB, STATECD))) %>%
    filter(propfor > 0) %>% 
    dplyr::select(State_Plot)
                                         
  for.pts <- left_join(total.plots2, TC1.2., by = "State_Plot") %>% 
    dplyr::select(State_Plot, LAT, LON) %>%
    distinct()
  
  for.pts <- for.pts[is.na(for.pts$LAT) == FALSE,]
  
  write_csv(for.pts, paste0(data.file.loc, "ForestedPts.csv")) 
  
  # Grabbing a layer of just the west-coast states.
  states <- sf::st_as_sf(maps::map("state", plot = FALSE, fill = TRUE))
  states2 <- states %>% mutate(west = ifelse(ID == "california" | ID == "washington" | ID == "oregon", 1, 0))
  
  # North America
  worldmap <- ne_countries(scale = 'medium', type = 'map_units',
                           returnclass = 'sf')
  NorAm <- worldmap[worldmap$continent == "North America",]
  NorAm2 <- sf::st_crop(NorAm, xmin = -180, xmax = 0, ymin = 0, ymax = 90)
  

  projcrs <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
  
  # Box for inset map. Box goes around the west coast states
  box_df = data.frame(lon = c(-126, -113), lat = c(32, 49.5))
  
  state.box <- box_df %>% 
    sf::st_as_sf(coords = c("lon", "lat"), 
                 crs = projcrs) %>% 
    sf::st_bbox() %>% 
    sf::st_as_sfc()
  
  # Main map of point distribution across states.
  pts.map <- ggplot() + 
    geom_sf(data = states[states$ID == "california" | states$ID == "oregon" | states$ID == "washington", ], fill = "white", size = 1) + 
    geom_point(data = for.pts, mapping = aes(x = LON, y = LAT), alpha = 0.25) +
    # coord_sf(xlim = c(-126, -113), ylim = c(32, 49.5), expand = FALSE) +
    theme_void() + 
    annotation_scale(style = "ticks") + 
    ggspatial::annotation_north_arrow(
      location = "bl", which_north = "true",
      pad_x = unit(0.4, "in"), pad_y = unit(0.4, "in"),
      style = ggspatial::north_arrow_nautical(
        fill = c("grey40", "white"),
        line_col = "grey20"
      )
    ) 
  
  
  # Inset map
  state.map <- ggplot() + 
    geom_sf(data = NorAm, fill = "white") +
    geom_sf(data = states2, aes(fill = factor(west)))  +
    geom_sf(data = state.box, fill = NA, size = 1) +
    coord_sf(xlim = c(-135, -55), ylim = c(15, 65), expand = TRUE) +
    scale_discrete_manual(aesthetics = "fill", values = c("white", "grey")) +
    theme_void() + 
    theme(legend.position = "none",
          panel.background = element_rect(colour = "black", size = 1))
  
  # Create PNG file
  png(paste0(ms.file.loc, "ForestedPts_Fig.png"), width = 5, height = 7, units = "in", res = 300)
  ggdraw(pts.map) +  # cowplot used here for creating inset map.
    draw_plot(state.map,
              x = 0.56, y = 0.27,
              width = 0.3, height = 0.4)      
  dev.off()
  
forest.pts <- include_graphics(paste0(ms.file.loc, "ForestedPts_Fig.png"))
  
}

forest.pts.caption <- paste0("Figure 1. Distribution of ", formatC(total.plot.for.num, format = "d", big.mark = ","), " forested FIA plots in the states of Oregon, Washington, and California.")  


```

```{r fig.RangeShift1.generation}
if (file.exists(paste0(ms.file.loc, "RangeShift_Fig.png"))) {
range.fig <-  include_graphics(paste0(ms.file.loc, "RangeShift_Fig.png"))
} else {

      # See dataprep function in functions.r
      r1 <- fia.dataprep.fcn("occ.", "t", "1", "e") %>% arrange(desc(response)) %>% 
        mutate(SciName2 = paste0("*", SciName, "*"))
      
      r1.order <- r1 %>% select(Spp.symbol) %>%
        mutate(order = seq(1:n()))
      
      r2 <- fia.dataprep.fcn("occ.", "p", "1", "e") %>%
        left_join(r1.order, by = "Spp.symbol") %>%
        arrange(order)
      
      gls.vals1 <- gls1[[which(names(gls1) == paste0("gls.", "occ.", "t", "1"))]]
      gls.vals2 <- gls1[[which(names(gls1) == paste0("gls.", "occ.", "p", "1"))]]

      plt1.title <- "Range Shift, Temperature"
      plt2.title <- "Range Shift, Precipitation"
        plt1.x.ax <- "Difference in temperature (\u00B0C)"
        plt2.x.ax <- "Difference in precipitation (mm)" 
      # Calling on plotting functions from functions.r

        source("ShinyCode/functions.r")

      q1 <- e.c.plot.fcn(r1, "response", gls.vals1, plt1.title, r1$SciName2, plt1.x.ax, NULL, 1, 12) 
      p1 <- e.c.plot.fcn(r2, "response", gls.vals2, plt2.title, r2$Spp.symbol, plt2.x.ax, NULL, 0, 12)#1)
      
      # plotting q1 (estimated mean/var) and p1 (bootstrap mean/var)
      ##  Change y-axis of p1 to null
      q1 <- as.grob(q1)
      p1 <- as.grob(p1)
      
      p_all <- plot_grid(q1, p1, ncol = 2, rel_widths = c(1, 0.6))

  png(paste0(ms.file.loc, "RangeShift_Fig.png"), width = 7, height = 9, units = "in", res = 300)
  p_all      
  dev.off()
  
range.fig <- include_graphics(paste0(ms.file.loc, "RangeShift_Fig.png"))
  
}

fig.rangeShift.cap = paste0("Figure 3.  Estimated mean range-shift temperature and precipitation differences between plot measurements for ", nrow(t1), " species.  For temperature and precipitation, mean changes greater than zero indicated that the species’ range was on average warmer or wetter, respectively, during the second visit.  The two plots include a vertical band representing the 95% GLS confidence interval for estimates of overall temperature or precipitation change among species.")
```


```{r fig.DensShift1.generation}
if (file.exists(paste0(ms.file.loc, "DensityShift_Fig.png"))) {
fig.densShift <- include_graphics(paste0(ms.file.loc, "DensityShift_Fig.png"))
} else {

      # See dataprep function in functions.r
      r1 <- fia.dataprep.fcn("num.", "t", "1", "e") %>% arrange(desc(response)) %>% 
        mutate(SciName2 = paste0("*", SciName, "*"))
      
      r1.order <- r1 %>% select(Spp.symbol) %>%
        mutate(order = seq(1:n()))
      
      r2 <- fia.dataprep.fcn("num.", "p", "1", "e") %>%
        left_join(r1.order, by = "Spp.symbol") %>%
        arrange(order)
      
      gls.vals1 <- gls1[[which(names(gls1) == paste0("gls.", "num.", "t", "1"))]]
      gls.vals2 <- gls1[[which(names(gls1) == paste0("gls.", "num.", "p", "1"))]]

      plt1.title <- "Density Shift, Temperature"
      plt2.title <- "Density Shift, Precipitation"
        plt1.x.ax <- "Difference in temperature (\u00B0C)"
        plt2.x.ax <- "Difference in precipitation (mm)" 
      # Calling on plotting functions from functions.r

      q1 <- e.c.plot.fcn(r1, "response", gls.vals1, plt1.title, r1$SciName2, plt1.x.ax, NULL, 1, 11) 
      p1 <- e.c.plot.fcn(r2, "response", gls.vals2, plt2.title, r2$Spp.symbol, plt2.x.ax, NULL, 0, 11)#1)
      
      # plotting q1 (estimated mean/var) and p1 (bootstrap mean/var)
      ##  Change y-axis of p1 to null
      q1 <- as.grob(q1)
      p1 <- as.grob(p1)
      
      p_all <- plot_grid(q1, p1, ncol = 2, rel_widths = c(1, 0.6))

  png(paste0(ms.file.loc, "DensityShift_Fig.png"), width = 7, height = 8, units = "in", res = 300)
  p_all      
  dev.off()
  
fig.densShift <- include_graphics(paste0(ms.file.loc, "DensityShift_Fig.png"))
  
}

fig.densShift.cap = paste0("Figure 4. Estimated mean temperature and precipitation differences between plots with more and fewer living trees upon the second visit for ", nrow(num.results.t), " species (density shift).  Mean changes greater than zero indicated that more trees for a species were found in warmer/wetter plots (and/or fewer trees were found in cooler/drier plots), on average.  Both plots include a vertical band representing the 95% GLS confidence interval for estimates of the overall difference in plot temperature or precipitation between plots with more and fewer trees.")

```


<br>

<br>      
   
Jeremiah D. Groom$^1$ and Vicente J. Monleon$^2$          
 

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

    
$^1$(Corresponding Author) Groom Analytics, LLC.  1975 SE Crystal Lake Dr., Corvallis, Oregon, 97333, United States of America.  jeremy@groomanalytics.com

$^2$Pacific Northwest Research Station, USDA Forest Service, 3200 SW Jefferson Way, Corvallis, Oregon, 97331, United States of America.  vicente.monleon@usda.gov



\pagenumbering{arabic}

\newpage

## Abstract
Climate change is associated with shifts in the geographic range of trees and other species globally.  In North America and elsewhere tree species' ranges are expected to shift at rates of meters to kilometers annually.  However, empirically detecting a shift in the range of a tree species may be difficult due to the lack of quality long-term regional or national data.  Evidence of range shifts is further confounded by apparently contradictory findings from separate studies that use different methods to evaluate species responses.  In this study we examine U.S. Forest Service Forest Inventory Analysis plot revisit data in the states of California, Oregon, and Washington to examine shifts in the ranges and densities of tree species relative to temperature and precipitation values using a design-based estimation technique.  We also examine changes in plot temperature and precipitation for the ten years between visits.  We found that the ranges for 49 tree species seldom shifted in the 10-year period of plot remeasurements but the density of nine out of 30 species did appear to shift, generally increasing in plots that were initially cooler and drier.  Changes in species' plot temperatures were usually best modeled as uniform increases across initial plot temperatures while annual precipitation values could increase or decrease relative to initial plot precipitation values, but not necessarily uniformly.  These results indicate that the geographical range of tree species of west coast U.S. may not change as quickly as their ecological niches geographically shift, although changes in species densities within their ranges may already be underway.  The results also indicate that changes in environmental conditions may differ among and within species' ranges.  

## 1. Introduction

The rate of vegetation change between 2000 BCE and now is faster than during the post-glaciation period 18,000 years ago and is likely caused by human impacts on plant species (Mottl et al. 2021).  Scientists have documented recent range shifts for a variety of terrestrial and marine taxa that correspond to a changing climate; e.g., latitudinal or elevation range shifts or changes in densities or cores within ranges  (see references in Lenoir and Svenning 2015).  For tree species, proximate climate-related drivers of range shifts may reduce species’ ranges. These drivers include insect and disease outbreaks and an increase in wildfire prevalence (see references in Weed et al. 2013, Jolly et al. 2015, Stanke et al. 2021).  Species range shifts can occur in climatically unexpected directions such as towards lower elevations or latitudes (Lenoir et al. 2010).  For trees, such shifts may be due to anthropogenic causes aside from climate change (e.g., fire suppression; Minnich et al. 1995, Dolanc et al. 2014).  Although tree-range modeling broadly indicates that North American tree species should directionally migrate towards previously cooler regions (McKenney et al. 2007, Iverson et al. 2008, Loarie et al. 2009) and distributional shifts within ranges appear widespread (Murphy et al. 2010, Fei et al. 2017), there is scant empirical evidence that ranges are currently directionally shifting towards previously cooler regions (Zhu 2012, Sittaro 2017, Woodall 2018).  

Modeling studies indicate that many tree species' ranges in North America may shift substantially in the coming decades (McKenney et al. 2007, Iverson et al. 2008).  Serra-Diaz et al. (2014) modeled climate-related range shifts for eight oak (*Quercus*) and pine (*Pinus*) species in California over the next 80 years and estimated that range-shift velocities would be affected by terrain, with species inhabiting relatively flat terrain experiencing faster range shifts than those in steep terrain.  Loarie et al. (2009) found the same topographical relationship for the speed of temperature change within biomes, with mountainous biomes shifting on average by 0.08 km/yr while flatter biomes (mangroves, deserts, grasslands) shifting by 1.26 km/yr over the next 80 years.  It is imperative that we determine whether tree species (and others) can shift their ranges with sufficient speed to match the changes underway in their niche space; otherwise, species may face substantial range contractions (McKenny et al. 2007, Iverson et al. 2008) and require management interventions to overcome dispersal barriers.    

Empirically detecting shifts in tree species' distributions and ranges is challenging because programs which collect tree plot data across many years using a geographically widespread and probabilistically-based sample design with consistent measurement protocols are rare.  Sampling designs and data-collection protocols enacted by governments, research institutions, or other organizations may change over time, lack methodological consistency across political boundaries, and/or not sample plots probabilistically.  Consequently, several analytical approaches have been used evaluate evidence of recent tree species range shifts.  
  
One method compares the distribution of seedlings or saplings relative to adults (Zhu et al. 2012, Monleon and Lintz 2015, Sittaro et al. 2017, Woodall et al. 2013, 2018). The Migration Hypothesis proposed by Zhu et al. (2014) predicts that seedling ranges may shift into previously unoccupied but newly favorable areas and out of regions that have become unsupportive of that life stage. This type of analysis has been done primarily by examining plot occupancy by seedlings or saplings and adult trees within longitudinal strips and estimating means of range limits for each age type. Latitude serves as a proxy for a climate-change signal in these studies, and may be justified as models (McKenney et al. 2007, Iverson et al. 2008) indicate that climate change may be expected to result in northerly range shifts.  However, seedling or saplings and adult tree distributions do not necessarily behave as predicted when analyses of their distributions are performed using revisit data. Sittaro et al. (2017) found evidence of seedling ranges shifting northward at a more rapid pace than adults, but they did not find that seedling ranges extended farther north than the ranges of adults. Woodall et al. (2018) similarly found seedlings south of adults.  Zhu et al. (2014) proposed the Turnover Hypothesis to explain observed patterns: warmer and wetter conditions could increase turnover rates, promoting elevated rates of mortality and recruitment. Their analysis of 65 species in the eastern United States supported the Turnover Hypothesis over the Migration Hypothesis.  Regardless, using the longitudinal strip method, Zhu et al. (2012) and Woodall et al. (2013, 2018) compared differences in the distributions between seedling/sapling and adult populations in the eastern United States but did not find evidence that the ranges of many species were shifting northward (but see Sittaro et al. 2017).     

Another approach for evaluating species’ responses to a changing climate is to quantify distribution shifts within ranges towards more habitable range edges instead of quantifying range edge changes (Kelly and Goulden 2008).  Murphy et al. (2010) and Fei et al. (2017) found shifts in plot abundance and occupancy within tree species’ ranges in the eastern United States northward (Murphy et al.) or northward and/or westward (Fei et al.).  Although these analyses do not capture changes in species geographical extents, they may be more sensitive to initial shifts in distribution. However, observing distributional shifts within ranges instead of shifts in range edges may indicate that a species lacks the ability to adjust to climatic shifts (Liang et al. 2018).  

Monleon and Lintz (2015) used a design-based analysis approach to estimate mean seedling vs. mature tree distributions across California, Washington, and Oregon along gradients of elevation, latitude, and average temperatures of sample plots.  Across species they found seedlings to inhabit cooler plots (based on plot means of temperatures from 1970 - 2000) than mature trees.  They favored the use of average plot temperature over latitude or elevation as it directly reflected plot temperatures instead of serving as a proxy of temperature. Their findings appear to contradict those of Zhu (2012) and Woodall et al. (2013, 2018) who did not find similar range shifts.  Stanke et al. (2021) similarly utilized design-based estimates of data from the U.S. Forest Service Forest Inventory and Analysis Program (FIA) to establish that relative densities of eight western tree species were declining, but their analysis did not directly examine the declines alongside environmental variables.   

As described above, previous studies have utilized different techniques for assessing the evidence of tree species distribution responses to a shifting climate.  Some findings, such as species range expansion with seedlings trailing adults (Fei et al. 2017, Sittaro et al. 2017, Woodall et al. 2018), appear counterintuitive or contradictory.  The Lenoir and Svenning (2015) literature review concluded that multifaceted approaches are needed when forecasting biodiversity responses to climate in order to provide comprehensive assessments of shifts in species' ranges.  They recommend that researchers examine the responses at trailing and leading edges of species’ ranges as well as the “optimum” within-range habitat (i.e., abundance).  They also recommend that these features be examined along latitudinal, elevational, and longitudinal gradients.    

Within the last decade the FIA has collected 10-year repeat visit data for their sample plots.  Similar to Monleon and Lintz (2015), this study capitalizes on the probabilistic FIA sampling design and develops design-based estimates to examine changes in two metrics of tree distribution relative to plot precipitation and temperature values.  Our study also examines the same pool of vegetation sampling plots used by Monleon and Lintz.  By utilizing revisit data, design-based estimates, and two climate-related variables, this study avoids model-based estimation assumptions and the use of proxy environmental gradients (latitude, elevation), and can directly assess changes over time instead of relying on interpretations of population features such as seedling and adult distributions.

The goal of this analysis was to evaluate the evidence of tree species distribution changes across the states of Washington, Oregon, and California, USA, over a 10-year period.  We examined distribution responses of tree species through the use of two metrics, "range shifts" and "density shifts", and two variables, plot temperature and precipitation.  We estimated a range shift by finding the difference in the mean of occupied plots' temperature (or precipitation) values between the first and second visit.  We estimated a density shift as the difference in mean temperature (or precipitation) values between plots that had more and fewer trees of a given species detected between visits.  Our secondary analysis goal was to examine our assumptions about environmental change at plots, which we approached by assessing the differences in temperature and precipitation between visits.   We created a data visualization dashboard (dashboard; <https://tinyurl.com/yc8cf4k9/>) so that users may explore analysis outcomes, compare results under different analysis scenarios, and examine data by and across species.   


## 2. Methods

This study relies on  US National Forest Inventory datasets for all forestland in California, Washington, and Oregon, USA. The field data were collected by the FIA which generally defines forestland as an area greater than 4,050 m$^2$ at least 10 percent stocked or potentially stocked with tree species, excluding urban and agricultural land uses (Reams et al. 2005).  The FIA sampling design consists of a spatially balanced  probability sample.  The standard density of FIA plots is one ground plot every 24 km$^2$.  Plots were initially measured in California and Oregon between 2001 and 2010 while Washington plots were measured between 2002 and 2011.  We only had access to remeasurement data between 2011 and 2019, or nine year-pairs of measurements for California and Oregon and eight for Washington (2012-2019).  Consequently, the general plot sampling intensity for Oregon and California is one plot every 26.7 km$^2$ and one plot every 30 km$^2$ for Washington.  Within the three states there were different plot densification efforts which increased the number of overall strata.  We post-stratified the FIA plots into 25 strata based on these sample densities and ancillary information (e.g., land classification, ownership).  We used the strata and associated weights when estimating range and density shift estimates (Appendix).  

The total sample size was `r formatC(total.plot.num, big.mark = ",")` plots, of which `r formatC(total.plot.for.num, big.mark = ",")`  were forested and `r formatC(total.plot.miss.num, big.mark = ",")`  could not be measured, either because the landowner denied access or because the plots were unsafe to reach or occupy (Figure 1).   Plot were configured with three points spaced 36.6m from a fourth center point and offset 120˚.   Plots containing forest land were installed and measured by field crews. At each of the four points within a plot, trees with stem diameter greater than or equal to 12.7 cm were tallied in a 7.32 m radius circular subplot (total area 672.5 m$^2$).  Crews also measured larger trees in macroplots (18m radius including the subplot at its center) and seedlings and saplings microplots (2.1m diameter plots within subplots).  For most species, stem diameter was measured at 1.37 m above the ground. Bechtold and Scott (2005) provide plot design details and measurement protocols. 


\newpage

```{r fig.map, fig.height = 8, fig.cap = forest.pts.caption}

forest.pts

```  



### 2.1 *Data*

The plot and tree data for this analysis were obtained from the Pacific Northwest Forest Inventory and Analysis Database (https://www.fs.usda.gov/pnw/page/pnw-fia-inventory-data/, accessed August 2022).  Specifically, we relied on the TREE, PLOT, and COND tables.  We imported the data into R 4.0.5 (R Core Team 2021).  The analysis makes use of all FIA plots in the sample regardless of whether they were occupied by target species.  We summarized the tree data to tally the number of live trees present for each species during each visit.    

We only included tree data from plots in Oregon, Washington, and California that were visited twice between 9 and 11 years apart (2001-2009 and 2011-2019).  We included all individual trees with diameters greater than 12.7 cm and excluded all trees ≥ 18.3m (60 feet) away from plot.  For the range-shift analysis we included macroplot data but excluded trees ≥ 7.3m (24 feet) from plot centers with DBH values > 61.0cm (24 inches) and < 76.2cm (30 inches) because FIA data collection protocols differentially tally these trees in plots depending on the regions in which the plots were located (Thompson 2015).   In the density-shift analysis we excluded all macroplot trees to standardize interpretations of tree density.   We removed *Prunus emarginata* from the analysis as this species often exhibits a shrub growth form. We also removed all trees that had been erroneously included in earlier surveys (e.g., they were located outside of plots).  We coded *Abies shastensis* as *Abies magnifica* because *A. shastensis* is a variety of *A. magnifica*.   

We included only those trees that were alive during both visits, alive at the first visit and then dead at the second, and those that reached a DBH > 12.7cm in the plot by the second visit.  We reviewed all trees that had species name changes between visits to determine which species identification was correct.  In the absence of other information, we selected the species name from the second visit as a species name change requires crew members to intentionally change the species code from what was recorded at the first visit.  

Some larger-diameter trees appeared during the second visit but were not coded as missed during the first visit.  If the diameter of these trees was greater than 12.7 cm plus the 99th percentile of the amount of growth observed for that species, they were coded as alive during both periods; otherwise, they were coded as ingrowth.   

For the range-shift analysis, a plot containing a species was coded as having the species present during both visits, completely dying out, or appearing as ingrowth within the plot.  If first-visit alive trees were dead by the second visit but ingrowth of the same species appeared, the plot was coded as containing the species alive for both visits.  For the density change analysis, the number of live trees for a species was considered during the first and second visit and a plot was labeled as having more, fewer, or the same number of live trees across visits.    

We validated species identifications by comparing occupied plot distributions against species range maps.  Species ranges were checked against the United States Department of Agriculture Natural Resources Conservation Service PLANTS database (<https://plants.usda.gov>, accessed August 2022) and specimen record locations provided by Discover Life (<https://www.discoverlife.org/>, accessed August 2022).  

### 2.2 *Analysis*  

Our analysis progression is depicted in Figure 2.  To summarize, we first obtained temperature and precipitation values for all FIA plots, for both the first and second visit periods. We then conducted the range shift and density shift analyses.  Finally, we examined between-visit changes in plot temperature and precipitation patterns.   


```{r AnalysisSteps, fig.width = 4, fig.asp = 2, fig.cap = "Figure 2. Analysis steps.  A: Predict temperature and precipitation values (open circles) from visit 1 and 2 values for each year (closed circles) for each FIA plot (e.g., Plot X).  B: Conduct range shift analysis for each species of interest. Range shift = mean of temperature or precipitation values for the population of plots occupied in visit 2 minus those occupied in visit 1. C: Conduct density shift analysis for each species of interest.  Density shift = mean of temperature or precipitation values for plots that gained individuals minus those that lost individuals. D: Temperature and precipitation across species-occupied plots.  For each species we examined how plot temperature and precipitation values changed between the two visits and related to visit 1 values.  For subplots B, C, and D, examples portray results for a single species and plot x axes use temperature or precipitation values from the visit 1 year (see text for explanation).  Graphical examples are for temperature, not precipitation."}

include_graphics(paste0(ms.file.loc, "Fig Analysis Steps3.1.png"))

```


We used the plot-level mean annual temperature and precipitation modeled output from the spatially gridded (800 m) parameter-elevation regressions on independent slopes model (PRISM; Daly et al. 2008) to obtain temperature and precipitation estimated values for all FIA plots used in our analyses.  We drew from PRISM output for 1990 - 2020.  For each plot we fit a slope and intercept to the ten sequential yearly temperature or precipitation values prior to and including the first plot visit, and repeated the process for the second visit.  We used the two regression models to respectively obtain predicted first and second visit plot temperature or precipitation values (Figure 2A). Although we predicted first and second visit temperature and precipitation values, the range and density shift analysis outcomes reported here only make use of the first-visit predicted values. The range shift analysis compares, for instance, the mean of the first-visit temperature values for plots that were occupied at visit 2 minus those that were occupied at visit 1 (Figure 2B).  We assumed that first-visit temperature and precipitation values would relate to conditions ten years later. Specifically, for temperature, we assume that plots have warmed in an approximately linear and constant fashion across species' ranges.  We did not know whether precipitation would consistently positively or negatively change across species' ranges.  We therefore, for each species, explored their plot changes in temperature and precipitation between the first and second visit relative to first visit values (Figure 2D).   

The range and density shift analyses followed standard survey sampling estimation procedures (Särndal et al. 1992) from a continuous population perspective (Cordy 1993).  For the range-shift analysis we computed an approximate design unbiased estimator of the weighted-domain sampling mean using either first-visit predicted temperature or precipitation values for plots (eqn 8, Appendix) for the first and second visit (Scott et al. 2005).  The weighted domains were derived from the different plot sampling intensities of the 25 strata (see above).  We estimated the difference in temperature (or precipitation) as the second visit mean minus the first visit mean, calculated as the difference between their respective domain ratio estimators (Wolter 1995; eqn 15, Appendix; Figure 2B).  We employed the same or similar equations as Monleon and Lintz (2015) to obtain estimates of the variance and confidence intervals (eqns 16 and 17, Appendix).  

We used a Generalized Least Squares (GLS) approach to estimate the mean difference in temperature (or precipitation) among all species as the average of individual species’ differences, weighted by the inverse of the estimated covariance matrix.  We obtained the variance-covariance matrix through bootstrapping because data for the covariance matrix were sparse and species were not independent (multiple species may occupy a single plot; see GLS equations 18 and 19 in the Appendix).       

The density-shift analysis made use of the same  procedure as described above, estimating a statistic of the difference between two ratios, the weighted domain sampling means of temperatures (or precipitation).  The analysis diverged from the original procedure in that it found the difference in mean temperature (or precipitation) between plots that had more and fewer individuals by the second plot visit (Figure 2C).   

Our range and density shift analyses did not control for multiple comparisons: “Non-significant” species responses, i.e., those with confidence intervals overlapping zero, do not necessarily imply a lack of response (Type-II error), and “significant” responses may be spurious (Type-I error).  We encourage readers to interpret “significant” individual responses as suggesting that patterns potentially, but do not necessarily, exist.  Although we discuss possible responses for individual species, our overall analysis findings consider the number of species with 95% confidence intervals that excluded zero and not the individual species.

We examined the change in precipitation and temperature values between the first and second visit for plots occupied by each species (Figure 2D).  The analysis sought to account for spatial autocorrelation of precipitation and temperature values for FIA plots while allowing for some flexibility in model form by creating and comparing two linear spatial error models (R package spatialreg, Bivand and Piras, 2020; Bivand et al. 2021).  We derived spatial point neighborhoods by using Gabriel graphs (Matula and Sokal 1980) and assessed the spatial autocorrelation in models with Moran's I test.  For both models the plot-level changes in temperature or precipitation served as a dependent variable.  The models differed in that one was an intercept-only model while the other also included a slope parameter associated with the first visit temperature or precipitation values (Figure 2D).  For each species and metric we selected between the two models by comparing model AIC values; the intercept model was preferred (i.e., more parsimonious) unless the slope model was better supported ($\Delta AIC$ < 3).    


### 2.3 *Data visualization*  

Our dashboard (<https://tinyurl.com/yc8cf4k9/>) enables viewers to compare different analyses, observe maps of species plot distributions, and view displays of temperature and precipitation values by species. The dashboard also includes range and density analysis results that use second-visit temperature and precipitation values instead of first visit values, and allows the visualization of results that use bootstrap variance estimation instead of the Taylor linearization method approximation.   


# 3. Results  

### 3.1 *Range shift analysis*  

During the first and/or second visit `r nrow(t1)`  species occupied `r formatC(total.plots.occ, big.mark = ",")` plots in total with each species occupying at least `r minOccPlots` plots at each visit (Table 1).  Of the `r nOccSpp` species, `r range.shift.gymno` were gymnosperms.  `r n.occ.cooler.all` of the species exhibited negative changes in their range-wide plot temperature means between visits, indicating a distributional range shift towards plots that were previously cooler (Figure 3).  The remaining `r length(occ.results.t$temSE[occ.results.t$temactmean > 0])` species exhibited mean shifts towards previously warmer plots.  `r numbers_to_words(n.occ.cooler + n.occ.warmer, cap = T)` of the species had 95% confidence intervals that did not overlap zero, which more strongly suggests that their ranges may have shifted.  During the second visit *`r occ.warmer.spp`* occupied, on average, previously warmer plots, while *`r occ.cooler.spp`*  occupied previously cooler plots.  `r numbers_to_words(n.occ.cooler + n.occ.warmer, cap = T)` significant findings out of `r nrow(occ.results.t)` at α = 0.025 may reasonably be expected to occur by chance alone if all significant findings represented Type-I errors (binomial *p* = `r p.est.occ.t`).   

\newpage

```{r Table_plots}
kable(t1, caption = "Table 1.  Species included in the analysis.  The Remained Occupied, Extirpated, and Colonized columns indicate, respectively, the number of FIA plots per species that were occupied during both visits, were occupied during the first visit but not the second, and were occupied during the second visit but not the first.  The columns Lost and Gained are the number of plots that lost or gained individuals of a given tree species.")

```
Note: Native species not reported above because, for the range shift analysis, they occupied fewer than 50 plots: *`r not.used.spp.vec1`*, and *`r not.used.spp.vec2`*.

<br>


```{r fig.RangeShift1, fig.cap = fig.rangeShift.cap}

range.fig

```

<br>

For the precipitation range-shift analysis, `r length(occ.results.p$temSE[occ.results.t$temactmean < 0])` species exhibited negative changes between visits which suggests a shift toward previously drier plots. The only species with a 95% confidence interval that did not overlap zero was the Port Orford cedar, *`r occ.wetter.spp`* (Figure 3), with a potential range shift towards plots that previously received more annual precipitation (i.e., wetter plots).  `r numbers_to_words(n.occ.wetter + n.occ.drier, cap = T)` significant finding out of `r nrow(occ.results.t)` by chance alone is not unexpected. 

The across-species GLS mean and 95% confidence interval for the range shift temperature (mean = `r occ.gls.t[2, 1]` °C, 95% CI = `r occ.gls.t[1, 1]` °C to `r occ.gls.t[3, 1]` °C) and precipitation (mean = `r occ.gls.p[2, 1]` mm, 95% CI = `r occ.gls.p[1, 1]` mm to `r occ.gls.p[3, 1]` mm) both encompassed zero which indicated that, overall, we found no evidence that species demonstrated a range shift towards regions that were previously warmer/cooler, or wetter/drier.  The GLS confidence interval bands are difficult to see in Figure 3 as they are narrow relative to the spread of the other data.

### 3.2 *Density change analysis*  

`r nNtreeSpp` species each inhabited at least `r minNtreePlots` plots that exhibited increases and decreases in the number of individuals of that species between visits (Table 1).   `r numbers_to_words(dens.shift.gymno, cap = T)` of those species were gymnosperms. The species density change analysis for temperature found that for `r length(num.results.t$temSE[num.results.t$temactmean < 0])` out of `r nrow(num.results.t)` species the difference in mean density estimates was negative (Figure 3).  Since the density change estimate is the mean temperature of plots that gained trees minus the mean temperature of plots that lost trees, a negative value indicates that the density shifted towards plots that were previously cooler (Figure 2C).  `r numbers_to_words(n.num.cooler + n.num.warmer, cap = T)` of the species had 95% confidence intervals that did not overlap with zero, suggesting a statistically significant difference at the multiple-comparison unadjusted α = 0.05.  The difference in mean temperature for *Pinus contorta* and *Pseudotsuga menziesii* was positive, which is consistent with a density shift towards previously warmer areas.  `r numbers_to_words(n.num.cooler, cap = T)` species (*`r num.cooler.spp`*) had a negative mean difference in temperature and 95% confidence intervals that did not include zero, consistent with a density shift towards areas that were previously cooler.  `r numbers_to_words(n.num.cooler + n.num.warmer, cap = T)` significant findings out of `r nrow(num.results.t)` at α = 0.025 is unexpected by chance (binomial *p* < 0.001).  Seven of the nine species exhibiting temperature-associated density shifts were gymnosperms.

The  density change analysis for precipitation found that the densities of `r n.num.drier.all` species shifted towards previously drier plots (Figure 4).  The 95% confidence intervals for `r numbers_to_words(n.num.drier, cap = F)` species with negative shifts (*`r num.drier.spp`*) did not contain zero. `r numbers_to_words(n.num.wetter, cap = T)` species, *`r num.wetter.spp`*, had densities shift towards previously wetter areas and a 95% confidence interval that did not contain zero.  This number of significant findings at α = 0.025 is unlikely due to chance alone (binomial *p* < 0.001).  Four of the eight species with density shifts associated with precipitation were gymnosperms.


```{r fig.DensShift1, fig.cap = fig.densShift.cap}

fig.densShift

```


The overall GLS estimates for the mean difference in temperature (and precipitation) between plots that had more and fewer trees was negative in both cases, with confidence intervals that did not include zero (for temperature, mean = `r num.gls.t[2, 1]` °C, 95% CI = `r num.gls.t[1, 1]` °C to `r num.gls.t[3, 1]` °C; for precipitation, mean = `r num.gls.p[2, 1]` °C, 95% CI = `r num.gls.p[1, 1]` °C to `r num.gls.p[3, 1]` °C).   Unlike Figure 3, these GLS confidence interval ranges are visible when plotted (Figure 4).

### 3.3 *Plot changes in precipitation and temperature*

When we examined the mean change for species' plots we found that temperature and precipitation generally increased.  For the `r nrow(occ.results.t)` species, intercept-only spatial error models had `r t.int.pos` and `r p.int.pos` statistically significant intercept values (α = 0.025) for temperature and precipitation, respectively (Table 2).  None of the intercept-only models for temperature had statistically significant negative intercept estimates, while for precipitation `r numbers_to_words(p.int.neg)` species exhibited significant negative mean values.    


```{r Table_plots3}
kable(t3, escape = FALSE, caption = "Table 2. Summary of spatial simultaneous autoregressive error model estimation of changes in plot temperature and precipitation across species' ranges between the first and second visits (see text). The column Metric is the mean positive or negative (+, -) change in either temperature or precipitation ($\\Delta$T, $\\Delta$P).  Intercept is the number of species with significant (p < 0.025) intercept estimates for intercept-only models.  The columns Slope+ and Slope- report the number of species which were better modeled with positive and negative slope terms, respectively, with the initial visit plot temperature or precipitation value serving as the model's independent variable. ")

```

The temperature change models for `r numbers_to_words(sum(t3[1:2, 3]), cap = F)` species were better fit with positive slopes associated with precipitation values from the first visit (i.e., previously warmer plots increased the most) while `r numbers_to_words(sum(t3[1:2, 4]), cap = F)` were better fit with negative slopes. The precipitation change models for `r numbers_to_words(sum(t3[3:4, 3]), cap = F) ` species were better fit with positive slopes associated with precipitation values from the first plot visit while `r sum(t3[3:4, 4])` improved with negative slopes (i.e., previously drier plots increased in precipitation and/or wetter plots decreased in precipitation).   Individual species' plot temperature and precipitation data along with geographic plot distributions may be accessed in the dashboard.  

### 3.4 *Additional results*

We found as many or more significant species results when the analysis relied on second-visit plot temperature or precipitation values instead of first-visit values, or used bootstrap confidence interval estimates instead of the Taylor linearization approximation approach.  Some species reported above exhibited confidence intervals that included zero under these other scenarios.  These additional results are viewable at the dashboard.  We are not reporting these results further for purposes of brevity and clarity.



# 4. Discussion  

We did not find strong evidence of tree species range shifts associated with temperature or precipitation within a ten-year interval. Shifts in means for individual species towards warmer/cooler or wetter/drier plots were approximately evenly split among species, a finding more firmly established by the across-species GLS confidence intervals.  The results for plot density changes differed; following the ten-year remeasure period, several species exhibited mean within-plot density shifts towards plots that were previously cooler.  We found a similar pattern for precipitation, where most "significant" species evidenced mean densities changes towards previously drier plots.  The GLS findings for the density change analysis indicated that, across species and within plots that experienced changes in tree numbers, overall densities were shifting towards previously cooler or drier plots.   

The spatial error analysis confirmed that we were generally safe to assume that mean temperature increases were even across all plots (although temperature increases were not the same across species).  Therefore, our analysis interpretation did not depend on temperature change as a function of initial plot temperatures.  The same was not true for precipitation.  Several species experienced a mean decrease in plot precipitation between the first and second visit although mean precipitation values increased for most species.  Unlike temperature, plot precipitation change was often negatively associated with first-visit plot precipitation values.  A majority of species experienced precipitation increases (or less of a decrease) at their initially drier plots.  Thus, a shift in a species' density towards initially drier plots may reflect a density shift towards relatively wetter (where "relatively wetter" = increase in precipitation) plots.  This pattern was observed for most "significant" species and may have represented recruitment in portions of species' ranges that would be most affected by increases in precipitation.    

Our findings are roughly consistent with those from other empirically-based analyses of species’ responses to climate change in North America.  Tree species’ ranges in eastern North America, as quantified, do not appear to be shifting (Zhu 2012, Sittaro 2017, Woodall 2018), although the density of species within their ranges may be (Fei et al. 2017, Murphy et al. 2010).  Murphy et al. found that eastern U.S. tree species' densities were greatest (“leaning” distributions;  Breshears et al. 2008) towards the northern (i.e., assumed cooler, but see Figure 1A in Fei et al. [2017]) margins.  Fei et al. (2017) found that changes in moisture appeared to be a stronger driver of species' density shifts than temperature, and that angiosperm densities appeared more related to moisture than temperature while gymnosperms were the opposite.  We had few enough species with density shifts that we are not drawing conclusions about gymnosperm or angiosperm comparisons.

Density analysis results for two species were at odds with findings from Monleon and Lintz (2015).  We found that plot densities were generally increasing in cooler plots for *Abies concolor* and *Calocedrus decurrens.*  However, Monleon and Lintz (2015) found that the seedlings of these species occupied warmer plots on average than mature trees.  The Turnover Hypothesis (Fei et al. 2017) may account for the discrepancy, as potentially seedlings of both species may be germinating but failing to survive in previously warmer, wetter plots.  Another explanation is that, given that their ranges broadly overlap, this study may be detecting drought and insect-related mortality of these species in the Sierra Nevada (USDA Office of Communications 2016), a warm and dry portion of their ranges (see the dashboard).       

Species range shift models indicate that, given predicted and observed climatic changes, we should expect tree species’ ranges to shift over time (Iverson et al. 2008, Serra-Diaz et al. 2014).  The west coast states of the continental United States have experienced conditions that generally differed from those in the 20$^{th}$ century, which may affect species distributions.  All three states have been experiencing increasing frequencies of droughts (Ficklin et al. 2015), wildfires (Westerling et al. 2006), and impacts from pests in non-coastal mountain ranges (Hicke et al. 2016).  Hydrologic regimes have shifted in all three states, with longer summer and fall periods of minimal precipitation (Holden et al. 2018), smaller snowpacks, and shorter snowpack durations (Mote et al. 2017).  Temperatures have generally increased in all three states (Westerling et al. 2006, Abatzoglou 2014).  We therefore presume that many of the species we examined are experiencing conditions that make persistence in many places more difficult.   However, our analysis failed to detect actual range shifts.      

There may be several non-exclusive explanations for our lack of range-shift detection.  One explanation is that our analysis lacked statistical power.  We were seeking evidence of range shifts based on revisited plots containing new species or lacking their previous inhabitants of a given species entirely.  We attempted to detect an overall change based on these sorts of plot-level changes following a revisit period of 10 years.  The revisit time period may have been too short given the range-shift metric we were applying.  Monleon and Lintz (2015) may have detected initial range-shifts by examining seedlings which then failed, within our study's timeframe, to manifest as colonization by trees.       

A second explanation is that geographical shifts in tree species' ranges may be constrained if species ranges abut and intermingle with other tree species ranges.  Zhu (2012), Sittaro et al. (2017), and Woodall et al. (2018) performed range-shift analyses in eastern North America and similarly did not find strong evidence of plot occupancy range shifts of trees.  This same constraint may enable within-range density shifts, observed in this study and by Fei et al. (2017) and Murphy et al. (2010).  Liang et al. (2018) modeled the ability of trees to migrate in the northeastern US given existing forest cover and fragmentation.  They found that it was unlikely that species could shift their ranges fast enough to match the velocity of change in their ecological niche location associated with projected climate change effects.  They explain that it may be difficult for seeds to disperse into previously marginal habitat and germinate under an existing forest canopy and successfully compete for light against existing seedlings.  Even with substantial disturbance, Liang et al. hypothesize that existing seed banks may out-compete incoming seeds.  Similarly, existing seedbanks may enable density increases at the favorable margins of a species' range.  

A final explanation is that our range-shift analysis used possibly useful but incomplete metrics.  Monleon and Lintz (2015) established that examining species shifts in west-coast USA states with previous plot temperature averages was likely superior to using elevation or latitude as proxies for climate change.  Our species range-shift examination relied on a similar temperature metric and examined range-shifts relative to a precipitation metric.  It may be that other metrics would better capture actual species range shifts, including different quantifications of temperature and precipitation.  Other metric possibilities include  pathogen and wildfire extent (e.g., using information similar to Hicke et al. 2016) and other species-specific habitat metrics (e.g., land use habitat modification; Lenoir et al. 2010).    

We believe that the density change analysis species with atypical findings highlight certain issues and complexities that confound  broad-scale interpretations of our findings across species.  One issue is that a species may experience different ecological pressures across its range.  For instance, we found that *Pinus contorta* and *Pseudotsuga menziesii* both shifted in density towards previously warmer and drier areas.  Both species appeared to experience, on average, elevated precipitation in previously drier plots, potentially enhancing recruitment relative to initially wetter plots.  We found the density shifts towards initially warmer plots surprising.  *P. contorta* is expected to lose habitat in the future as a consequence of climate change (Coops and Waring 2011), although subspecies may respond differently from one another and may potentially be able to undergo range expansion (Oney et al. 2013).  Similarly, Bell and Gray (2016) found that warmer and wetter regions were conducive for positive changes in *P. menziesii* biomass while different factors elsewhere in the species range promoted biomass increases.  Another confounding factor is that *P. menziesii* is an intensively managed species, and its management may affect its observed range and density.  Therefore, our range shift and density shift analysis results for these species (and others) may be overly simplistic, as our results likely blend the effects of different regional ecological pressures (see citations in both Lenoir et al. 2010 and Lenoir and Svenning 2015).  In effect, given the broad geographic sample of plots, our overall findings for some species may be potentially misleading as they result from the summary of numerous sub-regional associations (i.e., Simpson's Paradox).    

An issue complicating interspecific generalizations or comparisons is that species may encounter different environmental pressures.  *Quercus douglasii* exhibited a density shift towards initially wetter plots, unlike other species with "significant" density shifts related to precipitation.  This shift may have been predominantly driven by drought conditions, as precipitation generally decreased across its plots and previously drier sites may have been more susceptible to drought stress.  We note for this species that regions with the lowest initial precipitation (see dashboard) matched areas of dieback (see Figure 1 in McLaughlin et al. 2020).  Additionally, the actual response of the species may have been driven mainly or in part by changes in subsurface hydrology in addition to changes in precipitation (McLaughlin et al. 2020).  We find several considerations here: Observed changes in precipitation were neither unidirectional across species' ranges nor always constant across plots within species' ranges.  Thus, changes in precipitation may indeed be affected by climate change, but regionally precipitation may be affected to different degrees or in different directions (positive or negative change).  Plots inhabited by *Quercus douglasii* experienced a decrease in precipitation while other species experienced (often uneven) increases in precipitation.  Also, the actual ecological pressures affecting distribution changes likely differ by species and may be imperfectly associated with changes in mean annual temperature and precipitation.  

We anticipate that future FIA plot revisit data sets will enable analyses with greater ability to detect and quantify changes in species' ranges.  More time will pass for the environment to change and for species to respond.  Future FIA plot revisit data will help detect range shifts if indeed we are searching too soon for a signal from overly coarse presence/absence data.  In the meantime, the revisit data offer many avenues for exploring potential drivers of range changes for individual species, such as the prevalence and distribution of pests and diseases, impacts of fire and harvest, regional differences in tree growth, and size- or age-related mortality patterns.  


## 5. Conclusion

These findings indicate that the ranges of tree species within the contiguous west coast states of the US have not exhibited profound shifts relative to the temperature and precipitation metrics used in this study, although the density for some species may be changing within the ranges they currently inhabit.  There may be several reasons why we did not observe shifts in tree species ranges. Given the expected changes in geographical niches, these findings may point towards contractions in species ranges (McKenney et al. 2007).   

Our summaries of species range and density shifts across large geographical areas in relation to plot precipitation and temperature values hopefully provide useful large-scale information to managers and researchers.  The findings are probably best interpreted at the level of individual species, which we hope our dashboard facilitates, in combination with autecological information.  

## Declaration of competing interest
The authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper.

## Funding
This work was supported by the Oregon Department of Forestry, through contract ODF-2253A-20 and through the Oregon Department of Forestry and the Oregon State University Institute for Natural Resources contract ODF-1109A-19.   

## Data availability
Data, analysis code, and dashboard code are publicly available at our GitHub repository (<https://tinyurl.com/yeyrt9up/>). 

## Acknowledgements
We thank Andrew Yost from the Oregon Department of Forestry for supporting this project and for providing manuscript review.  We thank James Kagan from the Institute for Natural Resources, Oregon State University, for project assistance in its initial phase.  Also, we are grateful to FIA field crews for their expertise and efforts to provide quality data.  

## Appendix A: Supplementary material

Supplementary analysis methodology may be found online at: <https://tinyurl.com/43sp872x>

\newpage

## References

Abatzoglou, J.T., Rupp, D.E., Mote, P.W. 2014. Seasonal climate variability and change in the Pacific Northwest of the United States. J. Clim. 27, 2125-2142.  

Bechtold, W.A., Scott, C.T.  2005.  The Forest Inventory and Analysis plot design, in: Bechtold, W.A., Patterson, P.L. (Eds.), The Enhanced Forest Inventory and Analysis Program – National Sampling Design and Estimation Procedures. Gen. Tech. Rep. U.S. Dep. Agric. For. Serv. SRS-80.  

Bell, D.M., Gray, A.N. 2016. Assessing intra-and inter-regional climate effects on Douglas-fir biomass dynamics in Oregon and Washington, USA. For. Ecol. Manage. 379, 281-287.  

Bivand, R., Millo, G., Piras, G. 2021. A Review of Software for Spatial Econometrics in R. Mathematics, 9(11). https://doi.org/10.3390/math9111276.

Bivand, R., Piras, G. 2020. Spatialreg: Spatial Regression Analysis. https://CRAN.R-project.org/package=spatialreg (accessed 9 August 2022).

Breshears, D.D., Huxman, T.E., Adams, H.D., Zou, C.B., Davison, J.E. 2008. Vegetation synchronously leans upslope as climate warms. Proc. Natl. Acad. Sci. 105, 11591-11592.  

Coops, N.C., Waring, R.H. 2011. A process-based approach to estimate lodgepole pine (Pinus contorta Dougl.) distribution in the Pacific Northwest under climate change. Clim. Change. 105, 313-328.  

Cordy, C.B. 1993. An extension of the Horvitz—Thompson theorem to point sampling from a continuous universe. Stat. Prob. Lett. 18, 353-362.  

Daly, C., Halbleib, M., Smith, J.I., Gibson, W.P., Doggett, M.K., Taylor, G.H., Curtis, J., Pasteris, P.P. 2008. Physiographically sensitive mapping of climatological temperature and precipitation across the conterminous United States. Int. J. Climatol. 28, 2031-2064. https://doi.org/10.1002/joc.1688

Dolanc, C.R., Safford, H.D., Dobrowski, S.Z., Thorne, J.H. 2014. Twentieth century shifts in abundance and composition of vegetation types of the Sierra Nevada, CA, US. Appl. Veg. Sci. 17, 442-455.  

Fei, S., Desprez, J.M., Potter, K.M., Jo, I., Knott, J.A., Oswalt, C.M. 2017. Divergence of species responses to climate change. Sci. Adv. 3, e1603055. https://doi.org/10.1126/sciadv.1603055.

Ficklin, D.L., Maxwell, J.T., Letsinger, S.L. Gholizadeh, H. 2015. A climatic deconstruction of recent drought trends in the United States. Environ. Res. Lett. 10, 044009. https://doi.org/10.1088/1748-9326/10/4/044009

Hicke, J.A., Meddens, A.J.H., Kolden, C.A. 2016. Recent tree mortality in the western United States from bark beetles and forest fires. For. Sci. 62, 141-153.  

Holden, Z.A., Swanson, A., Luce, C.H., Jolly, W.M., Maneta, M., Oyler, J.W., Warren, D.A., Parsons, R., Affleck, D. 2018. Decreasing fire season precipitation increased recent western US forest wildfire activity. Proc. Natl. Acad. Sci. 115, E8349-E8357.  

Iverson, L.R., Prasad, A.M., Matthews, S.N., Peters, M. 2008. Estimating potential habitat for 134 eastern US tree species under six climate scenarios. For. Ecol. Manage. 254, 390–406.  

Jolly, W.M., Cochrane, M.A., Freeborn, P.H., Holden, Z.A., Brown, T.J., Williamson, G.J. and Bowman, D.M.J.S. 2015. Climate-induced variations in global wildfire danger from 1979 to 2013. Nat. Commun. 6, 1-11.  https://doi.org/10.1038/ncomms8537.

Kelly, A.E., Goulden, M.L. 2008. Rapid shifts in plant distribution with recent climate change. Proc. Natl. Acad. Sci. 105, 11823-11826.  

Lenoir, J., Gégout, J.C., Guisan, A., Vittoz, P., Wohlgemuth, T., Zimmermann, N.E., Dullinger, S., Pauli, H., Willner, W., Svenning, J.C. 2010. Going against the flow: potential mechanisms for unexpected downslope range shifts in a warming climate. Ecography. 33, 295-303.  https://doi.org/10.1111/j.1600-0587.2010.06279.x.

Lenoir, J., Svenning, J.C. 2015. Climate-related range shifts–a global multidimensional synthesis and new research directions. Ecography. 38, 15-28.  https://doi.org/10.1111/ecog.00967.

Liang, Y., Duveneck, M.J., Gustafson, E.J., Serra-Diaz, J.M., Thompson, J.R. 2018. How disturbance, competition, and dispersal interact to prevent tree range boundaries from keeping pace with climate change. Glob. Chang. Biol. 24, e335-e351.  https://doi.org/10.1111/gcb.13847.

Loarie, S.R., Duffy, P.B., Hamilton, H., Asner, G.P., Field, C.B., Ackerly, D.D. 2009. The velocity of climate change. Nature, 462, 1052-1055.  

Matula, D.W., Sokal, R.R. 1980. Properties of Gabriel graphs relevant to geographic variation research and the clustering of points in the plane. Geogr. Anal. 12, 205-222.

McKenney, D.W., Pedlar, J.H., Lawrence, K., Campbell, K., Hutchinson, M.F. 2007. Potential impacts of climate change on the distribution of North American trees. BioScience. 57, 939–948.  https://doi.org/10.1641/B571106.

McLaughlin, B.C., Blakey, R., Weitz, A.P., Feng, X., Brown, B.J., Ackerly, D.D., Dawson, T.E., Thompson, S.E. 2020. Weather underground: Subsurface hydrologic processes mediate tree vulnerability to extreme climatic drought. Glob. Chang. Biol. 26, 3091-3107.   https://doi.org/10.1111/gcb.15026.

Minnich, R.A., Barbour, M.G., Burk, J.H., Fernau, R.F. 1995. Sixty years of change in Californian conifer forests of the San Bernardino Mountains. Conserv. Biol. 9, 902-914.  

Monleon, V.J., Lintz, H.E.  2015.  Evidence of tree species’ range shifts in a complex landscape.  PLoS One. 10(1), e0118069.  https://doi.org/10.1371/journal.pone.0118069.

Mote, P.W., Li, S., Lettenmaier, D.P., Xiao, M., Engel, R. 2018. Dramatic declines in snowpack in the western US. NPJ Clim. Atmos. Science. 1, 2.  https://doi.org/10.1038/s41612-018-0012-1.

Mottl, O., Flantua, S.G.A., Bhatta, K.P., Felde, V.A., Giesecke, T., Goring, S., Grimm, E.C., Haberle, S., Hooghiemstra, H., Ivory, S., Kuneš, P., Wolters, S., Seddon, A.W.R., Williams, J.W. 2021. Global acceleration in rates of vegetation change over the past 18,000 years. Science. 372, 860-864.  https://doi.org/10.1126/science.abg1685.

Murphy, H.T., VanDerWal, J., Lovett-Doust, J. 2010. Signatures of range expansion and erosion in eastern North American trees. Ecol. Lett. 13, 1233-1244.    https://doi.org/10.1111/j.1461-0248.2010.01526.x.

Oney, B., Reineking, B., O'Neill, G. and Kreyling, J. 2013. Intraspecific variation buffers projected climate change impacts on Pinus contorta. Ecol. Evol. 3, 437-449.  https://doi.org/10.1002/ece3.426

R Core Team. 2021.  R: A Language and Environment for Statistical Computing.  R Foundation for Statistical Computing. Vienna, Austria.  https://www.R-project.org (accessed 30 November 2022). 

Reams, G.A, Smith, W.D., Hansen, M.H., Bechtold, W.A., Roesch, F.A., Moisen, G.G. 2005.  The forest inventory and analysis sampling frame, in: Bechtold, W.A., Patterson, P.L. (Eds.), The Enhanced Forest Inventory and Analysis Program – National Sampling Design and Estimation Procedures. Gen. Tech. Rep. U.S. Dep. Agric. For. Serv. SRS-80.  

Särndal C.E., Swensson, B., Wretman, J. 1992. Model Assisted Survey Sampling. New York: Springer-Verlag.   

Scott, C.T., W. A. Bechtold, G.A. Reams, W.D. Smith, J.A. Westfall, M.H. Hansen, Moisen, G.G. 2005. Sample-based estimators used by the Forest Inventory and Analysis National Information Management System, in: Bechtold, W.A., Patterson, P.L. (Eds.), The Enhanced Forest Inventory and Analysis Program – National Sampling Design and Estimation Procedures. Gen. Tech. Rep. U.S. Dep. Agric. For. Serv. SRS-80.  

Serra‐Diaz, J.M., Franklin, J., Ninyerola, M., Davis, F.W., Syphard, A.D., Regan, H.M, Ikegami, M. 2014. Bioclimatic velocity: the pace of species exposure to climate change. Divers. Distrib. 20, 169-180.  https://doi.org/10.1111/ddi.12131.

Sittaro, F., Paquette, A., Messier, C., Nock, C.A. 2017. Tree range expansion in eastern North America fails to keep pace with climate warming at northern range limits. Glob. Chang. Biol. 23, 3292-3301.  https://doi.org/10.1111/gcb.13622.

Stanke, H., Finley, A.O., Domke, G.M., Weed, A.S., MacFarlane, D.W. 2021. Over half of western United States' most abundant tree species in decline. Nat. Commun. 12, 451.  https://doi.org/10.1038/s41467-020-20678-z.

Thompson, J. 2015.  PNW-FIADB Users Manual: A data dictionary and user guide for the PNW-FIADB database.  Forest Inventory and Analysis, Pacific Northwest Research Station, Portland, Oregon.  

USDA Office of Communications. 2016.  New Aerial Survey Identifies More Than 100 Million Dead Trees in California.  USDA Forest Service: Vallejo, CA, USA. <https://tinyurl.com/2p98xuxy>

Weed, A.S., Ayres, M.P., Hicke, J.A. 2013. Consequences of climate change for biotic disturbances in North American forests. Ecol. Monogr. 83, 441-470.  

Westerling, A.L., Hidalgo, H.G., Cayan, D.R., Swetnam, T.W. 2006. Warming and earlier spring increase western US forest wildfire activity. Science. 313, 940-943. https://doi.org/10.1126/science.1128834. 

Wolter, K.M.  1985. Introduction to Variance Estimation. New York: Springer-Verlag.  

Woodall, C.W., Westfall, J.A., D'Amato, A.W., Foster, J.R., Walters, B.F. 2018. Decadal changes in tree range stability across forests of the eastern US. For. Ecol. Manage. 429, 503-510.  https://doi.org/10.1016/j.foreco.2018.07.049.
  
Woodall, C.W., Zhu, K., Westfall, J.A., Oswalt, C.M., D’amato, A.W., Walters, B.F., Lintz, H.E. 2013. Assessing the stability of tree ranges and influence of disturbance in eastern US forests. For. Ecol. Manage. 291, 172-180.  http://dx.doi.org/10.1016/j.foreco.2012.11.047

Zhu, K., Woodall, C.W., Clark, J.S. 2012. Failure to migrate: lack of tree range expansion in response to climate change. Glob. Chang. Biol. 18, 1042-1052.  https://doi.org/10.1111/j.1365-2486.2011.02571.x

Zhu, K., Woodall, C.W., Ghosh, S., Gelfand, A.E., Clark, J.S. 2014. Dual impacts of climate change: forest migration and turnover through life history. Glob. Chang. Biol. 20, 251-264. https://doi.org/10.1111/gcb.12382










